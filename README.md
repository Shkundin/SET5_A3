# SET 5 — A3: HyperLogLog (HyperMegaLogLog Pro Max++)

Репозиторий содержит **полностью воспроизводимое** решение задания **A3**:
- инфраструктура генерации потоков `RandomStreamGen`;
- генерация 32-битной хеш-функции `HashFuncGen` (диапазон `M = 2^32`);
- реализация **HyperLogLog** для оценки `N_t` и точный подсчёт `F^t_0`;
- построение графиков №1 и №2 по требованиям задания;
- опционально: версия HLL с **упаковкой регистров** для снижения потребления памяти.

## Структура
- `include/random_stream_gen.h` — генератор потока строк и разбиение на части (шаги).
- `include/hash_func_gen.h` — хеширование строк в `uint32_t` (равномерное распределение).
- `include/hll.h`
  - `HyperLogLog32` — стандартный HLL (регистры `std::vector<uint8_t>`).
  - `HyperLogLog32Packed` — packed-вариант (регистры упакованы по `W` бит).
- `src/main.cpp` — эксперимент: генерация потоков, подсчёты, CSV, измерение памяти.
- `scripts/plot.py` — построение `report/graph1.png` и `report/graph2.png`.
- `data/` — выходные CSV и измерение памяти.
- `report/report.md` — краткий отчёт и выводы.
- `report/graph1.png`, `report/graph2.png` — итоговые графики.

## Требования
- C++17
- CMake ≥ 3.16
- Python 3 + пакеты: `pandas`, `numpy`, `matplotlib`

## Сборка
Из корня проекта:
```bash
mkdir -p build
cd build
cmake ..
cmake --build . -j
```

## Запуск эксперимента
Запускать **из корня проекта** (так пути к `data/` и `report/` совпадут):
```bash
./build/a3_hll
```

После запуска будут созданы/перезаписаны файлы:
- `data/per_stream.csv` — значения по каждому потоку и шагу (для проверок/отладки).
- `data/stats.csv` — агрегированные статистики по шагам: среднее и σ.
- `data/memory.txt` — оценка потребления памяти для стандартной и packed-версии.
- `report/graph1.png`, `report/graph2.png` — итоговые графики.

## Построение графиков
```bash
python3 scripts/plot.py
```

### График №1
- **X** — размер обработанной части потока (processed)
- **Y** — число уникальных
- линии: истинное `F^t_0` и оценка `N_t`

### График №2
- линия `E(N_t)` (среднее по потокам)
- область неопределённости: `E(N_t) ± σ_{N_t}`

## Параметры эксперимента (соответствуют заданию)
В `src/main.cpp` параметры задаются константами в начале `main()`:
- `B` — число первых бит хеша для индекса (`m = 2^B` регистров).
- `streams` — число независимых потоков для статистик.
- `n` — размер потока.
- `steps` — на сколько частей делим поток (например, 20 → шаг 5%).
- генератор потока поддерживает контролируемую долю повторов (для реалистичных `F^t_0`).

Выбранный `B` должен быть кратко обоснован: в отчёте сравнивается эмпирическая ошибка с теоретическими рамками
`1.04 / sqrt(m)` и `1.3 / sqrt(m)` (как в задании).

## Повторяемость
Эксперимент детерминирован: в генераторе используются фиксированные seed’ы, поэтому результаты можно воспроизвести.

## Как проверять корректность
1. Соберите и запустите `./build/a3_hll`.
2. Убедитесь, что появились `data/stats.csv` и графики в `report/`.
3. Сравните линии на графике №1: `N_t` должна близко следовать за `F^t_0`.
4. На графике №2 проверьте, что разброс укладывается в ожидаемые рамки (см. `report/report.md`).

